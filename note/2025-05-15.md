app/
├── ai/
│   ├── combat/                  # 기존 combat.py를 폴더로 분리
│   │   ├── __init__.py          # 모듈 초기화
│   │   ├── graph.py             # LangGraph 전체 구조 정의
│   │   ├── nodes/               # 전투 그래프의 각 노드 모듈
│   │   │   ├── __init__.py
│   │   │   ├── situation.py     # 상황 판단 노드
│   │   │   ├── strategy.py      # 전략 결정 노드
│   │   │   ├── target.py        # 타겟 선택 노드
│   │   │   ├── action.py        # 행동 생성 노드
│   │   │   └── resource.py      # 리소스 계산 노드
│   │   ├── states.py            # 그래프 상태 정의
│   │   └── utils.py             # 그래프 관련 유틸리티 함수



분기 처리 부족:  
improve_combat.md에서 설명된 조건 분기 처리가 실제 구현에 반영되지 않음  
현재 그래프는 선형적 흐름만 있으며, 조건별 분기 처리가 없음


전투 시스템의 LangGraph 관련 코드를 리팩토링하여 유지보수성을 크게 개선해주세요. 다음 원칙에 따라 코드를 정리해주세요:  
  
## 1. 구조 개선  
- 단일 책임 원칙에 따라 함수 분리 (함수당 하나의 책임)  
- 길이가 30줄 이상인 함수는 작은 단위로 분리  
- 중첩 조건문 최소화 (early return 패턴 활용)  
- 명확한 계층 구조 설계 (노드 간 인터페이스 표준화)  
  
## 2. 코드 정리  
- 불필요한 디버깅 코드 및 주석 제거  
- 중복 코드 공통 함수로 추출  
- 변수/함수명을 역할에 맞게 명확히 변경  
- type hints 일관되게 적용  
  
## 3. 제거할 불필요한 기능  
- print 문을 통한 디버깅 로직 (로깅 시스템으로 대체)  
- 사용되지 않는 함수/변수  
- 복잡한 예외처리 중 핵심적이지 않은 것들 단순화  
  
## 4. 성능 최적화  
- LLM 호출 최소화 (필수적인 경우만 호출)  
- 반복적인 계산 캐싱  
- 불필요한 깊은 복사 제거  
  
## 5. 테스트 용이성  
- 순수 함수 지향 (부작용 최소화)  
- 의존성 주입 패턴 적용  
- 상태 변경을 명시적으로 처리  
  
리팩토링 시 기능 동작은 변경하지 말고, 코드 품질과 가독성 개선에만 집중해주세요.