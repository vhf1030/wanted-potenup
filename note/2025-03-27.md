### Lora 모델 만들기
- 이미지 태깅: https://iii.ad/54aa66
	1. 구글 드라이브 복사
	2. setup: 프로젝트 저장소 만들기
	3. 이미지 업로드
	4. curate images
	5. tag images
	6. curate tags
	7. ready: Lora 준비 

- Lora train
	1. 구글 드라이브 복사 및 t4 설정
	2. setup: 기존 프로젝트 저장소
	3. 파라미터 세팅
		- training_model: stable diffusion
		- num_repeats: 1 (이미지가 적을수록 반복 횟수를 늘려야 함 - 10 ~ 20장 -> 15)
		- epoch_how_many: 5 (이미지가 적을수록 반복 횟수를 늘려야 함 - 10 ~ 20장 -> 20)
		- batch_size: 2 (그래픽 카드가 좋을수록 높이면 됨)
	4. 






### 프로젝트
기존의 코드 @streamlit_app.py 가 너무 복잡해서 리팩토링을 하려고 해. 구조는 다음과 같이 진행할 예정이야. 
├── frontend/
│   ├── __init__.py       # 패키지 초기화 파일
│   ├── app.py            # 메인 앱 진입점
│   ├── config.py         # 설정 관리
│   ├── session.py        # 세션 및 상태 관리
│   ├── pages.py          # 페이지 컴포넌트
│   ├── websocket.py      # WebSocket 통신 관리
│   ├── camera.py         # 카메라 관련 기능
│   └── utils.py          # 유틸리티 함수

기존 코드의 기능 외에 다른 로직(logging 등)은 절대로 추가하지 마. 몇 번 시도했지만 웹캠 화면 출력하는 부분에서 문제가 계속 발생했으니 주의해서 진행해줘. 기존 코드의 기능을 최대한 그대로 유지하는 방식으로 진행해줘. 스트림릿 진입점은 이거야. C:\wanted\KOMI_PJT\komi_service>streamlit run ./frontend/app.py 기존 코드는 수정할 필요 없어.

임포트 경로는 komi_service를 기준으로 작성해줘 (예시: from frontend.utils import my_function)




**문제 요약:**

- **현상**: Streamlit에서 카메라 2대를 동시에 출력하려 할 때 영상이 출력되지 않거나, 하나의 카메라만 출력됨.
- **가능한 원인**: WebSocket 연결 구조, 이미지 큐 처리, 동기화 로직, 세션 관리 등.

---

**점검 및 해결 방법 정리:**

1. **WebSocket 연결 구조 확인**
    
    - 웹소켓 연결이 카메라 수만큼 각각 별도로 안정적으로 생성되고 있는지 확인.
    - 다중 카메라 선택 시 웹소켓 스레드가 **중복 실행**되거나 **연결이 충돌**할 수 있으므로:
        - 앱 시작 시 **한 번만** 웹소켓 연결 생성되도록 구조 조정 필요.
        - 카메라 ID별로 웹소켓 연결을 구분하거나, 하나의 웹소켓이 여러 스트림을 받아올 수 있게 설계.
2. **이미지 큐 처리 구조 개선**
    
    - 각 카메라 스트림을 처리하는 큐가 개별적으로 존재해야 함 (camera1 → queue1, camera2 → queue2).
    - 큐가 꽉 찼을 경우 **오래된 프레임을 제거**하고 **최신 프레임을 유지**해야 실시간성이 보장됨.
    - `if queue.full(): queue.get()` 로 먼저 비운 뒤 `queue.put()` 하기.
3. **카메라 선택 UI 및 상태 관리**
    
    - 카메라가 **하나만 선택되어도 출력**되도록 UI 조건 분기 개선.
    - "선택 안함"을 명확하게 처리하고, 선택된 카메라가 없다면 안내 메시지 제공.
4. **프레임 동기화 로직 간소화 또는 제거**
    
    - 현재 구조에서 **동기화된 프레임**만 출력되도록 되어 있다면, 선택된 카메라 수가 2개 미만일 때는 **동기화 조건을 해제**하거나 **개별 출력 허용** 로직 추가 필요.
5. **Streamlit 세션 상태 및 스레드 상태 확인**
    
    - 카메라별 출력 슬롯이 별도로 존재하는지 확인.
    - 각각의 카메라 스트림이 독립적으로 업데이트되도록 세션 상태(`st.session_state`) 혹은 캐싱 구조 사용 고려.
6. **추가 점검 항목**
    
    - 각 카메라 ID가 시스템에서 올바르게 인식되고 있는지 `cv2.VideoCapture(0)` vs `cv2.VideoCapture(1)` 확인.
    - 동시 출력 시 OS 또는 드라이버 차원에서 **카메라 리소스를 공유하지 못하는 경우**도 있음 → 이 경우 외장 카메라를 두 개 이상 사용하거나, 가상 카메라 드라이버 필요.

---

**예상되는 해결 조치 요약:**

- 웹소켓 스레드 구조를 단일화하거나 다중 카메라에 맞게 분리.
- 이미지 큐를 카메라별로 분리하고, 오래된 프레임 제거 로직 적용.
- Streamlit에서 하나만 선택해도 바로 출력되도록 UI 수정.
- 동기화 기준 완화 또는 선택된 카메라 수에 따라 조건 분기 적용.
  
  
기존 코드의 기능 외에 다른 로직(logging 등)은 절대로 추가하지 마. 몇 번 시도했지만 웹캠 화면 두개를 출력하는 부분에서 문제가 계속 발생했으니 주의해서 진행해줘. 기존 코드의 기능을 최대한 그대로 유지하는 방식으로 진행해줘. 프론트엔드 모듈 외에 다른 코드를 확인해야 하는 경우 알려줘.

우선 1. WebSocket 연결 구조 확인 부터 진행하자